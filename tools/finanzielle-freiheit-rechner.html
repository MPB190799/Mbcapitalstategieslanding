<script>
function calcFreedom() {

  // IDs sauber abrufen
  const elStart = document.getElementById("startCapital");
  const elSave  = document.getElementById("monthlySave");
  const elTarget = document.getElementById("targetIncome");
  const elYield = document.getElementById("yield");
  const elGrowth = document.getElementById("growth");
  const elTax = document.getElementById("taxRate");

  // Werte extrahieren (NEUE sichere Variablen)
  const start = parseFloat(elStart.value) || 0;
  const save = parseFloat(elSave.value) || 0;
  const target = parseFloat(elTarget.value) || 0;
  let yieldPct = (parseFloat(elYield.value) || 0) / 100;
  const growthPct = (parseFloat(elGrowth.value) || 0) / 100;
  const tax = (parseFloat(elTax.value) || 0) / 100;
  const reinvest = document.getElementById("reinvest").checked;

  const resultsEl = document.getElementById("ffResults");
  resultsEl.innerHTML = "";

  if (target <= 0 || (yieldPct <= 0 && save <= 0)) {
    resultsEl.innerHTML = "<h2>Ergebnis</h2><p>Bitte Eingaben pr√ºfen.</p>";
    return;
  }

  let wealth = start;
  let netDivYear = 0;
  let reached = false;
  let year = new Date().getFullYear();

  for (let i = 1; i <= 60; i++) {
    wealth += save * 12;

    const grossDiv = wealth * yieldPct;
    netDivYear = grossDiv * (1 - tax);

    if (reinvest) wealth += grossDiv;

    yieldPct *= (1 + growthPct);

    if (netDivYear / 12 >= target) {
      year = new Date().getFullYear() + i;
      reached = true;
      break;
    }
  }

  const title = "<h2>Ergebnis</h2>";

  if (!reached) {
    resultsEl.innerHTML = title + `<p>Ziel wird in 60 Jahren nicht erreicht.</p>`;
    return;
  }

  const netMonth = netDivYear / 12;

  resultsEl.innerHTML = `
    ${title}
    <p>Jahr der finanziellen Freiheit: <span class="ff-highlight">${year}</span></p>
    <p>Depotvolumen: <span class="ff-highlight">${wealth.toLocaleString("de-DE",{style:"currency",currency:"EUR"})}</span></p>
    <p>Nettodividende pro Jahr: <span class="ff-highlight">${netDivYear.toLocaleString("de-DE",{style:"currency",currency:"EUR"})}</span></p>
    <p>Pro Monat: <span class="ff-highlight">${netMonth.toLocaleString("de-DE",{style:"currency",currency:"EUR"})}</span></p>
  `;
}
</script>
